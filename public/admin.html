<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MCB Admin</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
<!-- â­ Vercel Analytics -->
<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>
<script>
  if (localStorage.getItem("isAdmin") !== "true") {
    alert("Admin access only");
    location.href = "/";
  }
  
  const adminSession = sessionStorage.getItem("adminSession");
  if (!adminSession) {
    alert("Please log in again");
    localStorage.removeItem("isAdmin");
    location.href = "/admin-login.html";
  }
  
  const adminInfo = JSON.parse(adminSession);
</script>

<h2>ğŸ›  Admin Page</h2>
<p>Logged in: <strong id="adminName"></strong> <button onclick="logout()">Logout</button></p>
<button onclick="location.href='/'">â† Back to Main</button>

<hr>

<!-- Tab Menu -->
<div class="tabs">
  <button class="tab-btn active" onclick="showTab('players')">Player Management</button>
  <button class="tab-btn" onclick="showTab('matches')">Match Management</button>
  <button class="tab-btn" onclick="showTab('admins')">Admin Management</button>
  <button class="tab-btn" onclick="showTab('logs')">Activity Logs</button>
</div>

<div class="admin-layout">

  <!-- Player Management Tab -->
  <div id="tab-players" class="tab-content active">
    <div class="admin-sidebar">
      <h3>ğŸ§‘â€ğŸ¤â€ğŸ§‘ Players</h3>
      <div class="player-add">
        <input id="newPlayerName" placeholder="Name">
        <button onclick="addPlayer()">+</button>
      </div>
      <ul id="playerList"></ul>
    </div>
  </div>

  <!-- Match Management Tab -->
  <div id="tab-matches" class="tab-content">
    <div class="admin-main">
      <h3>ğŸ® Match List</h3>
      <div id="matchList"></div>
    </div>
  </div>

  <!-- Admin Management Tab -->
  <div id="tab-admins" class="tab-content">
    <h3>ğŸ‘¥ Admin List</h3>
    
    <div class="admin-add">
      <h4>Add New Admin</h4>
      <input id="newAdminUsername" placeholder="Username" style="width: 150px">
      <input id="newAdminPassword" type="password" placeholder="Password" style="width: 150px">
      <input id="newAdminName" placeholder="Name" style="width: 150px">
      <button onclick="addAdmin()">Add</button>
    </div>
    
    <div id="adminList"></div>
  </div>

  <!-- Activity Logs Tab -->
  <div id="tab-logs" class="tab-content">
    <h3>ğŸ“‹ Activity Logs (Last 100)</h3>
    <div id="logList"></div>
  </div>

</div>

<script src="/admin.js?v=3"></script>

<script>
document.getElementById("adminName").textContent = adminInfo.name;

// â­ URL íŒŒë¼ë¯¸í„° í™•ì¸í•´ì„œ íƒ­ ìë™ ì„ íƒ
window.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const tab = urlParams.get('tab');
  
  if (tab) {
    // URLì— tab íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ íƒ­ ì—´ê¸°
    showTab(tab);
  } else {
    // ì—†ìœ¼ë©´ ê¸°ë³¸ players íƒ­
    loadPlayers();
  }
});

function showTab(tabName) {
  document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
  document.querySelectorAll(".tab-btn").forEach(el => el.classList.remove("active"));
  
  document.getElementById(`tab-${tabName}`).classList.add("active");
  
  // â­ í•´ë‹¹ íƒ­ ë²„íŠ¼ë„ active ì²˜ë¦¬
  const buttons = document.querySelectorAll(".tab-btn");
  const tabIndex = {
    'players': 0,
    'matches': 1,
    'admins': 2,
    'logs': 3
  };
  if (tabIndex[tabName] !== undefined) {
    buttons[tabIndex[tabName]].classList.add("active");
  }
  
  if (tabName === 'admins') loadAdmins();
  if (tabName === 'logs') loadLogs();
  if (tabName === 'matches') loadMatches();
  if (tabName === 'players') loadPlayers();
}

function logout() {
  localStorage.removeItem("isAdmin");
  sessionStorage.removeItem("adminSession");
  location.href = "/admin-login.html";
}

function editMatchFromAdmin(matchId) {
  sessionStorage.setItem("editMatchId", matchId);
  location.href = "/";
}
</script>

</body>

<footer style="text-align: center; padding: 20px; margin-top: 40px; border-top: 1px solid #333; color: #888;">
  ğŸ‘¨â€ğŸ’»  Code by bk & Coffee by s | Â© 2025
</footer>
</html>